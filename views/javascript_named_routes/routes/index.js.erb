var Routes = (function() {
  var _ = {};
  
  var _route = function(required, optional, names) {
    return function() {
      var i, params = [];
      
      if (arguments.length == 1 && typeof arguments[0] == "object") {
        for (i = 0; i < names.length; ++i) {
          if (!arguments[0][names[i]])
            break;
          params.push(arguments[0][names[i]]);
        }
      } else {
        for (i = 0; i < arguments.length; ++i) {
          params.push(arguments[i]);
        }
      }
      
      var path = [], pi = 0;
      for (i = 0; i < required.length; ++i) {
        path.push(required[i] === _ ? params[pi++] : required[i]);
      }
      for (i = 0; i < optional.length && pi < params.length; ++i) {
        path.push(optional[i] === _ ? params[pi++] : optional[i]);
      }
      return path.join('');
    };
  };
  
  return {
  <% separator = '' -%>
  <% for name, required, optional, segment_keys in @route_data %>
    <%= separator %><%= name %>: _route(<%= required %>, <%= optional %>, <%= segment_keys %>)<% separator = ',' -%>
  <% end -%>

  };
}());
